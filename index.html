<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <title>Unity WebGL Player | Vitrine</title>
    <style>
      body {
        display: flex;
        height: 100vh;
        margin: 0;
      }

      #left-panel {
        flex: 1;
        background-color: #eaeaea;
        padding: 20px;
        display: flex;
        align-items: center;
        justify-content: center;
        position: relative;
        overflow: hidden;
      }

      #shared-screen {
        width: 100%;
        height: 100%;
        object-fit: contain;
        position: absolute;
        top: 0;
        left: 0;
      }

      #right-panel {
        flex: 1;
        display: flex;
        align-items: center;
        justify-content: center;
        background-color: #231F20;
      }

      canvas {
        width: 100%;
        height: 100%;
        background: #231F20;
      }
    </style>
  </head>
  <body>
    <div id="left-panel">
      <button id="start-sharing">Commencer le partage</button>
      <video id="shared-screen" autoplay></video>
    </div>
    <div id="right-panel">
      <canvas id="unity-canvas"></canvas>
    </div>
    <script src="Build/ScreenShare.loader.js"></script>
    <script>
      function captureFrame() {
        const canvas = document.createElement('canvas');
        const context = canvas.getContext('2d');
        const video = document.getElementById('shared-screen');

        canvas.width = Math.min(video.videoWidth, unityInstance.Module.canvas.width);
        canvas.height = Math.min(video.videoHeight, unityInstance.Module.canvas.height);
        context.drawImage(video, 0, 0, canvas.width, canvas.height);
        const imageData = canvas.toDataURL(); // Convertir l'image en données au format base64

        // Envoyer les données de l'image via Photon RPC à d'autres utilisateurs connectés
        unityInstance.SendMessage('ScreenShareManager', 'ShareScreen', imageData);
      }

      const startSharingButton = document.getElementById('start-sharing');
      const sharedScreenVideo = document.getElementById('shared-screen');

      let mediaStream;

      startSharingButton.addEventListener('click', async () => {
        try {
          mediaStream = await navigator.mediaDevices.getDisplayMedia({ video: true });
          sharedScreenVideo.srcObject = mediaStream;
        } catch (error) {
          console.error('Erreur lors du partage d\'écran : ', error);
        }
      });

      if (/iPhone|iPad|iPod|Android/i.test(navigator.userAgent)) {
        // Mobile device style: fill the whole browser client area with the game canvas:
        const meta = document.createElement('meta');
        meta.name = 'viewport';
        meta.content =
          'width=device-width, height=device-height, initial-scale=1.0, user-scalable=no, shrink-to-fit=yes';
        document.getElementsByTagName('head')[0].appendChild(meta);

        const canvas = document.querySelector('#unity-canvas');
        canvas.style.width = '100%';
        canvas.style.height = '100%';
        canvas.style.position = 'fixed';

        document.body.style.textAlign = 'left';
      }

      createUnityInstance(document.querySelector('#unity-canvas'), {
        dataUrl: 'Build/ScreenShare.data',
        frameworkUrl: 'Build/ScreenShare.framework.js',
        codeUrl: 'Build/ScreenShare.wasm',
        streamingAssetsUrl: 'StreamingAssets',
        companyName: 'DefaultCompany',
        productName: 'Vitrine',
        productVersion: '0.1.0',
      }).then(function (instance) {
        unityInstance = instance;
      });
    </script>
  </body>
</html>
